(function($){
    $.widget("ui.volet",{
        options:{
            open:false,
            disabled:false,
            event:'click',
            position:'bottom',
            size:100,
            min:0,
            max:0,
            animate:{
                effect:'slide',
                options:{easing:'swing',duration:1000}
            }
        },
        _create:function(){
            var o=this.options;
            var self=this;
            var elt=this.element;
            if(o.animate){
                o.animate={
                    effect:typeof o.animate.effect=="undefined"?'slide':o.animate.effect,
                    duration:typeof o.animate.duration=="undefined"?300:o.animate.duration,
                    options:typeof o.animate.options=="undefined"?{}:o.animate.options
                };
            }
            self.isOpen=o.open;
            self.isDisabled=o.disabled;
            //GEOVIEWER this line reload scripts loaded by the mappane.
            //elt.parent().wrapInner('<div class="ui-volet-blockContainer"></div>');
            elt.wrap('<div class="ui-helper-reset ui-widget ui-volet "></div>');
            elt.before('<div class="ui-volet-handleContainer ui-state-default"><div class="ui-volet-toggleHandle"></div></div>');
            elt.addClass('ui-widget-content');
            var voletContainer=elt.parent();
            var handleContainer=elt.prev();
            var parent=voletContainer.parent();
            var toggleHandle=$('.ui-volet-toggleHandle',handleContainer);
            self.elements={
                'voletContainer':voletContainer,
                'handleContainer':handleContainer,
                'parent':parent,
                'toggleHandle':toggleHandle
            };
            self.backups={
                'parentStyle':parent.attr('style')?parent.attr('style'):'',
                'selfStyle':elt.attr('style')?elt.attr('style'):''
            };
            parent.css('position','relative');
            voletContainer.css('position','absolute');
            voletContainer.css(o.position,'0');

            if(parseFloat(handleContainer.css('height'))){
                handleH=handleContainer.css('height');

            }else{
                handleH='20px';
                handleContainer.css('height','20px');
            }
            parent.css('padding-'+o.position,
                handleContainer.outerHeight(true));
            self.setVoletSize();
            elt.css('overflow','auto');

            if(self.isOpen){
                self._toggleClasses();

            } else {
                elt.hide();
            }

            if(self.isDisabled)
                self.disable(true);

            else self.enable(true);
        },
        setVoletSize:function(){var elt=this.element;var voletContainer=this.elements.voletContainer;var handleContainer=this.elements.handleContainer;var parent=this.elements.parent;voletContainer.css('width',parent.width()-(voletContainer.outerWidth()-voletContainer.width())+'px');handleContainer.css('width',voletContainer.width()-(handleContainer.outerWidth(true)-handleContainer.width())+'px');elt.css('width',voletContainer.width()-(elt.outerWidth(true)-elt.width())+'px');},_updateSize:function(e){var resizeData=e.data.resizeData;var h=-e.pageY+resizeData.offTop+resizeData.height;resizeData.target.css('height',h);},_stopUpdate:function(e){$(document).unbind('.volet');},_addEventHandler:function(){var o=this.options;var self=this;var elt=this.element;if(o.event){self.elements.toggleHandle.bind((o.event)+'.volet',function(event){self.toggleDisplay();event.preventDefault();});self.elements.handleContainer.bind('mousedown.volet',function(e){self.elements.voletContainer.addClass("ui-volet-resize");var target=elt;var resizeData={height:target.height(),offTop:e.pageY,target:target};$(document).bind('mousemove.volet',{resizeData:resizeData},function(e){self._updateSize(e);return false;}).bind('mouseup.volet',function(e){self.elements.voletContainer.removeClass('ui-volet-resize');self._stopUpdate(e);return false;});return false;}).bind("mouseenter.volet",function(){$(this).addClass('ui-state-hover');}).bind("mouseleave.volet",function(){$(this).removeClass('ui-state-hover');}).bind("focus.volet",function(){$(this).addClass('ui-state-focus');}).bind("blur.volet",function(){$(this).removeClass('ui-state-focus');});}},_removeEventHandler:function(){var self=this;self.elements.toggleHandle.unbind('.volet');self.elements.handleContainer.unbind('.volet');},destroy:function(){var self=this;var elt=this.element;delete self.isOpen;delete self.isDisabled
elt.removeClass("ui-widget-content");self._removeEventHandler();self.elements.handleContainer.remove();elt.unwrap();elt.unwrap();if(self.backups.parentStyle!='')self.elements.parent.attr('style',self.backups.parentStyle);else self.elements.parent.removeAttr('style');if(self.backups.selfStyle!='')elt.attr('style',self.backups.selfStyle);else elt.removeAttr('style');delete self.elements;$.Widget.prototype.destroy.call(self);},toggleEnable:function(isInit){isInit=typeof isInit=="undefined"?false:isInit;var self=this;var elt=this.element;if(isInit?!self.isDisabled:self.isDisabled){self._addEventHandler();}
else if(!(isInit||self.isDisabled)){self._removeEventHandler();}
if(!(!self.isDisabled&&isInit)){self.isDisabled=!self.isDisabled;elt.toggleClass("ui-collapsible-disabled");}},enable:function(isInit){isInit=typeof isInit=="undefined"?false:isInit;var self=this;if(isInit||self.isDisabled)self.toggleEnable(isInit);},disable:function(isInit){isInit=typeof isInit=="undefined"?false:isInit;var self=this;if(isInit||!self.isDisabled)self.toggleEnable(isInit);},_toggleClasses:function(){var self=this;self.elements.handleContainer.toggleClass("ui-state-default").toggleClass("ui-state-active");},toggleDisplay:function(){var o=this.options;var self=this;self.isOpen=!self.isOpen;if(o.animate){var animations=$.ui.volet.animations;animations[o.animate.effect](self,o.animate.options);}
else{self._toggleClasses();}},open:function(){var self=this;if(!self.isOpen)self.toggleDisplay();},close:function(){var self=this;if(self.isOpen)self.toggleDisplay();}});$.extend($.ui.volet,{version:"1.0.0",animations:{slide:function(obj,options,additions){options=$.extend({easing:"swing",duration:300},options,additions);var fxAttrs={height:"toggle",paddingTop:"toggle",paddingBottom:"toggle",marginTop:"toggle",marginBottom:"toggle"};obj.element.animate(fxAttrs,options.duration,options.easing,function(){obj._toggleClasses();});return;}}});})(jQuery);